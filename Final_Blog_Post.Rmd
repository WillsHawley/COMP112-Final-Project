---
title: "Final Blog Post"
author: "Alex McCreight, Lucy Grochulska, Jacob Kresnicka, Wills Hawley"
output: html_document
runtime: shiny
---

```{r setup,message=FALSE,include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(shiny)
library(ggthemes)
```
```{r,message=FALSE,include=FALSE}
Spotify_Top_2017 <- read_csv("Spotify/Spotify Top 2017.csv")
Spotify_Top_2018 <- read_csv("Spotify/Spotify Top 2018.csv")
Spotify_Big <- read_csv("SpotifyFeatures.csv")
replace(Spotify_Big,"Children’s Music","Children's Music")

Spotify_Master<-Spotify_Top_2017 %>% 
  bind_rows(Spotify_Top_2018)
```


# Spotify Data

![](https://i.pinimg.com/originals/27/6f/27/276f273d11f8b9dbc0a9c55bb38ea8c6.gif)

### What effects the popularity of music?


### Overview 

We examined the "Spotify Track DB" dataset published by Zaheen Hamidani on Kaggle. This dataset included a total of 232,725 tracks, sampled from the  26 genres on Spotify. Each of these tracks has a total of 18 variables which we can use to compare and make observations. Our goal with the data was to examine what variables made an impact on popularity, with the hopes of uncovering the secret to making some sick bops. 

### Key Variables 


* popularity = The popularity of the track. The value will be between 0 and 100, with 100 being the most popular. The popularity is calculated by algorithm and is based on the total number of plays the track has had and how recent those plays are.
Songs that are being played frequently now will have a higher popularity than songs that were played frequently in the past.

* acousticness = A confidence measure from 0.0 to 1.0 of whether the track is acoustic. 1.0 represents high confidence the track is acoustic.

* danceability = Danceability describes how suitable a track is for dancing based on a combination of musical elements including tempo, rhythm stability, beat strength, and overall regularity. A value of 0.0 is least danceable and 1.0 is most danceable.

* duration_ms =	The duration of the track in milliseconds.

* energy = Energy is a measure from 0.0 to 1.0 and represents a perceptual measure of intensity and activity. Energetic tracks feel fast, loud, and noisy. For example, death metal has high energy, while a Bach prelude scores low on the scale. Perceptual features contributing to this attribute include dynamic range, perceived loudness, timbre, onset rate, and general entropy.

* instrumentalness 

* liveness = Detects the presence of an audience in the recording. Higher liveness values represent an increased probability that the track was performed live. A value above 0.8 provides strong likelihood that the track is live. 

* Loudness 

* speechiness = Speechiness detects the presence of spoken words in a track. The more exclusively speech-like the recording (talk show, audio book), the closer to 1.0 the  value. Values above 0.66 describe tracks that are probably made entirely of spoken words. Values between 0.33 and 0.66 describe tracks that may contain both music and speech, including rap. Values below 0.33 most likely represent music. 

* tempo = 

* valence = 	A measure from 0.0 to 1.0 describing the musical positiveness conveyed by a track. High valence =  positive (e.g. happy, cheerful, euphoric), while low valence = negative (e.g. sad, depressed, angry).

* key = The estimated overall key of the track. E.g. 0 = C, 1 = C♯/D♭, 2 = D, and so on. If no key was detected, the value is -1.

* mode = Mode indicates the modality (major or minor) of a track, Major is represented by 1 and minor is 0.

* time_signature = An estimated overall time signature of a track. 

The table below provides a mean value for the numerical variables we are examining. This excludes variables such as mode, which is a categorical variable. 

```{r,layout="1-body-outset"}
library(knitr)
library(rmarkdown)
Mean_Variables<-Spotify_Big %>% 
  summarize("Average Popularity"=mean(popularity),
            "Average Acousticness"=mean(acousticness),
            "Average Danceability"=mean(danceability),
            "Average Duration"=mean(duration_ms),
            "Average Energy"=mean(energy),
            "Average Instrumentalness"=mean(instrumentalness),
            "Average Liveness"=mean(liveness),
            "Average Loudness"=mean(loudness),
            "Average Speechiness"=mean(speechiness),
            "Average Tempo"=mean(tempo),
            "Average Valence"=mean(valence))
kable(Mean_Variables)
```

### Challenges 

* In attempting to make serious observations from this data, we encountered several issues. The first among these is the sheer size and scope of the data. There are 270,000+ observations and 18 variables with which to compare them. Any attempt at making visualizations will either convey a very small portion of the data, or be too cluttered to reasonably understand. 
 
* There is also the issue of the variables present in the dataset. Given that they are based on algorithms developed by Spotify and the publisher, they are not necessarily 100% accurate. This error has lead to some interesting discoveries, like a death metal song being categorized as children's music. This is not the case for the vast majority of observations, but is present nonetheless. 

### Analysis

```{r,fig.height=8,fig.width=12}
Spotify_Big %>% 
  ggplot() +
  geom_boxplot(aes(x=fct_reorder(genre,.x=popularity,.fun=median),
                   y=popularity,fill=genre)) +
  coord_flip() +
  labs(x="Genre",y="Popularity") +
  theme_minimal() +
  guides(fill="none")
  
```

* Here we see that there is major variability based on 


```{r, echo=FALSE,message=FALSE}
library(shiny)
library(tidyverse)
library(ggthemes)
library(ggplot2)
Spotify_Big <- read_csv("SpotifyFeatures.csv") 
shinyApp(
ui <- fluidPage(
  navbarPage("Spotify Data Analysis App",
             tabPanel("Plot 1",
  titlePanel("Geometric Hexagon Plot"),
    sidebarLayout(
      sidebarPanel(
        selectInput(inputId = "genre", label = "Genre of Music",
                              choices = list("A Capella", "Alternative", "Anime", "Blues", "Children's Music", "Classical", "Comedy",
                                             "Country", "Dance", "Electronic", "Folk", "Hip-Hop", "Indie", "Jazz", "Movie", "Opera",
                                             "Pop", "R&B", "Rap", "Reggae", "Reggaeton", "Rock", "Ska", "Soul", "Soundtrack", "World")),
                  selectInput(inputId = "xaxis", label = "Measure of Music",
                              choices = list(Danceability = "danceability", Acousticness = "acousticness",
                                             `Duration in Milliseconds` = "duration_ms",
                                             Energy = "energy", Intrumentalness = "instrumentalness",
                                             Liveness = "liveness",
                                             Loudness = "loudness", Speechiness = "speechiness",
                                             Tempo = "tempo", Valence = "valence")),
                  submitButton(text="Apply Changes")),
    mainPanel(plotOutput(outputId = "spotplot")))),
    tabPanel("Plot 2",
             titlePanel("Boxplot Distribution"),
             sidebarLayout(
               sidebarPanel(
                 checkboxGroupInput(inputId = "genre1", label = "Genre of Music",
                                                    choices = list("A Capella", "Alternative", "Anime", "Blues", "Children's Music", "Classical", "Comedy",
                                                                   "Country", "Dance", "Electronic", "Folk", "Hip-Hop", "Indie", "Jazz", "Movie", "Opera",
                                                                   "Pop", "R&B", "Rap", "Reggae", "Reggaeton", "Rock", "Ska", "Soul", "Soundtrack", "World")),
                                        selectInput(inputId = "xaxis1", label = "Measure of Music",
                                                    choices = list(Danceability = "danceability", Acousticness = "acousticness",
                                                                   `Duration in Milliseconds` = "duration_ms",
                                                                   Energy = "energy", Intrumentalness = "instrumentalness",
                                                                   Liveness = "liveness",
                                                                   Loudness = "loudness", Speechiness = "speechiness",
                                                                   Tempo = "tempo", Valence = "valence")),
                                        submitButton(text="Apply Changes")),
                           mainPanel(plotOutput(outputId = "boxplot")))
                                        )
    )
  ),


server <- function(input, output){
  output$spotplot <- renderPlot({
    Spotify_Big %>%
      filter(genre == input$genre) %>%
      ggplot(aes(y=popularity)) +
      geom_hex(aes_string(x=input$xaxis)) +
      labs(y="Popularity", fill = "Distribution of Songs") +
      theme_clean() +
      scale_fill_viridis_c()
    }, height = 700, width = 800)
  
  output$boxplot <- renderPlot({
    Spotify_Big %>%
      filter(genre %in% input$genre1) %>%
      ggplot(aes(x=genre, fill = genre)) +
      geom_boxplot(aes_string(
                       y=input$xaxis1
                       )) +
      labs(x="Genre", fill = "Genre Color") +
      coord_flip() +
      guides(fill = "none")
  }, height = 700, width = 800)
}, options = list(height = 1100, width = 1500)
)
```

* On Plot 1 we utilized a Hexagonal Plot
  
  * This plot breaks down the variables within the genre. For example, we look at Valence to see how positve and negative songs are. Across the 3 most popular genres the valence distribution is spread but the popularity remains about the same area. This plot emphasize a more specific analysis of the distribution of songs within a genre.

* On Plot 2 we utilized a Boxplot

  * The top 3 genres are Pop, Rock, and Rap. Songs in these genres on average are more popular. We can make a comparison between these three genres and the least popular genres Movie, Children's Music, and A Capella. Using the energy variable the top 3 genres have an energy of rating of 0.75 but the lesser 3 fall below 0.50. Our graphs pickup the trend showing the factors that might affect the popularity of a song.
  
* It is important that we included both of these plots because the Hexagonal plot provides a micro view of how variables are represented within a genre where as the Boxplot shows easier to read relationships between multiple genres given a measure of music.
